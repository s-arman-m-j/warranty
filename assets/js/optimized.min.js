// optimized.min.js
"use strict";const ASG={config:{ajaxUrl:asgConfig.ajaxUrl,nonce:asgConfig.nonce,isRTL:asgConfig.isRTL,debugMode:asgConfig.debugMode},init:function(){this.warrantyForm.init(),this.imageUploader.init(),this.notifications.init(),this.datePicker.init(),this.reports.init()},warrantyForm:{init:function(){const t=document.querySelector(".warranty-form");t&&(this.form=t,this.bindEvents())},bindEvents:function(){this.form.addEventListener("submit",this.handleSubmit.bind(this))},async handleSubmit(t){t.preventDefault();try{const e=new FormData(this.form),n=await this.submitForm(e);ASG.notifications.show(n.message,n.success?"success":"error")}catch(t){ASG.notifications.show("خطا در ارسال فرم","error")}},async submitForm(t){const e=await fetch(ASG.config.ajaxUrl,{method:"POST",body:t,headers:{"X-WP-Nonce":ASG.config.nonce}});if(!e.ok)throw new Error("Network response was not ok");return await e.json()}},imageUploader:{init:function(){this.uploadBtn=document.getElementById("asg-upload-btn"),this.imagePreview=document.getElementById("asg-image-preview"),this.imageInput=document.getElementById("image_id"),this.uploadBtn&&this.bindEvents()},bindEvents:function(){this.uploadBtn.addEventListener("click",this.openMediaUploader.bind(this)),document.addEventListener("click",t=>{t.target.classList.contains("asg-remove-image")&&this.removeImage(t)})},openMediaUploader:function(){const t=wp.media({title:"انتخاب تصویر",button:{text:"انتخاب"},multiple:!1,library:{type:"image"}});t.on("select",()=>{const e=t.state().get("selection").first().toJSON();this.imageInput.value=e.id,this.imagePreview.innerHTML=`<div class="asg-preview-item"><img src="${e.sizes.thumbnail.url}" alt="پیش‌نمایش"><button type="button" class="button button-small asg-remove-image">حذف</button></div>`}),t.open()},removeImage:function(t){t.preventDefault(),this.imageInput.value="",this.imagePreview.innerHTML=""}},notifications:{init:function(){this.container=document.createElement("div"),this.container.className="asg-notifications",document.body.appendChild(this.container)},show:function(t,e="info",n=3e3){const i=document.createElement("div");i.className=`asg-notification asg-notification-${e}`,i.textContent=t,this.container.appendChild(i),setTimeout(()=>i.remove(),n)}},datePicker:{init:function(){const t=document.querySelectorAll(".asg-datepicker");t.length&&t.forEach(t=>{new persianDatepicker(t,{format:"YYYY/MM/DD",initialValue:!1,autoClose:!0,persianDigit:!0,observer:!0,calendar:{persian:{locale:"fa"}},timePicker:{enabled:!1},onSelect:function(e){t.dispatchEvent(new Event("change"))}})})},format:function(t){return t?new persianDate(t).format("YYYY/MM/DD"):""}},reports:{init:function(){const t=document.getElementById("asgStatusChart"),e=document.getElementById("asgMonthlyChart");t&&this.initStatusChart(t),e&&this.initMonthlyChart(e)},async initStatusChart(t){try{const e=await this.fetchChartData("status"),n={type:"pie",data:{labels:e.labels,datasets:[{data:e.data,backgroundColor:["#FF6384","#36A2EB","#FFCE56","#4BC0C0"]}]},options:{responsive:!0,plugins:{legend:{position:"right"}}}};new Chart(t,n)}catch(t){console.error("Error loading status chart:",t)}},async initMonthlyChart(t){try{const e=await this.fetchChartData("monthly"),n={type:"line",data:{labels:e.labels,datasets:[{label:"تعداد درخواست‌ها",data:e.data,borderColor:"#36A2EB",tension:.1,fill:!1}]},options:{responsive:!0,scales:{y:{beginAtZero:!0,ticks:{stepSize:1}}}}};new Chart(t,n)}catch(t){console.error("Error loading monthly chart:",t)}},async fetchChartData(t){const e=await fetch(`${ASG.config.ajaxUrl}?action=asg_get_chart_data&type=${t}&nonce=${ASG.config.nonce}`);if(!e.ok)throw new Error("Network response was not ok");return await e.json()}}};document.addEventListener("DOMContentLoaded",()=>ASG.init());